# Common Lispのイベントタイマライブラリを作ろうと思ったが…

この記事は[進捗 Advent Calendar 2020](https://github.com/t-sin/shinchoku-advent-calendar-2020)の7日目の記事です。

## 概要

Common Lisp向けのイベントタイマライブラリを作ろうと思ったけどやめました。[リポジトリはこちら](https://github.com/t-sin/clet)です。

## 動機

音楽系ソフトウェアをつくろうと思うと、特にイベントの処理と音声信号処理を分離しようと思うと、イベントタイマが必要になる気がしていました。イベントがたとえば描画とかのスレッドに引きずられてしまうと描画タイミングでしかイベントを発せないので、結果として分解能が低くなってしまう、と考えたためです。そのため、HPET (High Precision Event Timer) をも含めてイベントタイマを抽象化したライブラリがほしいと思って取り掛かりました。HPETは10ナノ秒くらいだったかの精度を持つイベントタイマで、こいつが普及してきたいまそれを使えば、十分に精度のあるイベント処理ができるのではと思ったのです。

APIインターフェースのベースとして[SBCLのタイマーライブラリ](http://www.sbcl.org/manual/#Timers)を参考に実装をすすめていました。

## 結果

[GNU/LinuxにおいてHPETの利用はroot権限が必要でシステムにもそう数があるものでもないし、ユーザ権限でおいそれと使えるものではありませんでした](https://github.com/t-sin/clet/issues/1)。断念。

## 結論

冷静に考えると、音楽系ソフトウェアはHPETがCPU (というかマザーボード?) にはいってないマシンでも動いていたわけで、音楽プログラミングにおいてHPETは必須ではないのかしらというのが現在の気持ちです。音楽ソフトウェアのための模索の過程のひとつということでここはひとつ。

---

明日はもうちょっと進捗していておもしろいリポジトリの話をします。
